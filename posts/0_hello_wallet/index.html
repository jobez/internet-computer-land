<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>hello, wallet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">hello, wallet</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="incredible-counting-on-internet-computers" class="level1">
<h1>incredible counting on internet computers</h1>
<p>I’ll start with a brief little ‘how to’ guide of building a ui that can ‘reach out’ to a browser extension wallet and then ‘do things with’ a contract on starknet. If you think some other technology is way better than starknet, take a deep breath and treat this as me simply using one instance of the general class of <sub><em>internet computers</em></sub>. Then, in a following section, I’ll try to probe some of the theory of how that is happening.</p>
<p>There is a little bit of incidental detail that I’ll ellide here, as I am using <a href="https://quarto.org">Quarto</a> which (in turn) lets me use <a href="https://quarto.org/docs/computations/ojs.html">observable</a> for computation. We can kind of squint and treat it as ‘just’ javascript and I’ll defer all the details on how it isn’t to the creators <a href="https://observablehq.com/@observablehq/observables-not-javascript">here</a>.</p>
<p>We will see how well observable plays with contract interop. Here we only break a little ground and in subsequent iterations.</p>
<p>So we start by pulling in <code>starknetjs</code> and <code>get_starknet</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-startfrom="15" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 14;"><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>starknetjs <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://jspm.dev/starknet"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>get_starknet <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://jspm.dev/get-starknet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>Then we write a async function that uses <code>get_starknet</code> to display to a user an interface for selecting and consenting a wallet and a given account to a session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-startfrom="21" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 20;"><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">connectWallet</span>(e)  {</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>   <span class="kw">var</span> wallet <span class="op">=</span>  <span class="cf">await</span> get_starknet<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>   <span class="cf">await</span> wallet<span class="op">.</span><span class="fu">enable</span>()<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> wallet<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<p>And consider this some boiler plate for observable to give me a little button view that, on clicked, will present aforementioned wallet interface.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="32" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 31;"><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>wallet <span class="op">?</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>wallet<span class="op">.</span><span class="at">selectedAddress</span><span class="sc">}</span><span class="vs">, you achieved things. You pushed through. You did it.`</span> <span class="op">:</span> <span class="fu">md</span><span class="vs">`Come on. All you need to do is install a browser plugin. You can do it.`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-startfrom="37" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 36;"><span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>viewof wallet <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Connect"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">reduce</span><span class="op">:</span> connectWallet})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<p>If you had the audacity to push through the resistance and actually install a browser plugin wallet, you can see that its object unifies a couple of abstractions we will get into in the question of how a client and contract on a chain interact: <code>account</code> and <code>provider</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-startfrom="45" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 44;"><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>wallet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
<p>With a wallet, we can construct an interface to a contract that ‘lives’ on a chain. We also need said contracts <code>abi</code> which is the contract’s application binary interface and the contracts address.</p>
<p>The abi is constructed when you compile a cairo contract and the address is generated from the deployment of a contract to a chain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-startfrom="54" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 53;"><span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>contract <span class="op">=</span> {</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> abi <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"../counter_abi.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> wallet <span class="op">?</span> (<span class="kw">new</span> starknetjs<span class="op">.</span><span class="fu">Contract</span>(abi<span class="op">,</span> <span class="st">"0x036486801b8f42e950824cba55b2df8cccb0af2497992f807a7e1d9abd2c6ba1"</span><span class="op">,</span> wallet<span class="op">.</span><span class="at">account</span>)) <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<p>Here we call a view method, basically reading state from the contract. Observable has some magic that lets me treat promises like regular statements, but everything ‘across’ the contract interaction is asynchronous.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-startfrom="64" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 63;"><span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> contract<span class="op">.</span><span class="fu">counter</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-startfrom="68" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 67;"><span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>contract <span class="op">?</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>count<span class="sc">}</span><span class="vs"> is the count`</span> <span class="op">:</span> <span class="kw">null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="expression">

</div>
</div>
</div>
<p>Increment counter mutates the contract state.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="75" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 74;"><span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">callIncrement</span>(e)  {</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>   <span class="kw">var</span> txn <span class="op">=</span> <span class="cf">await</span> contract<span class="op">.</span><span class="fu">incrementCounter</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> txn<span class="op">;</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<p>Invoking it gives us an object with a transaction hash.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" data-startfrom="83" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 82;"><span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>viewof incrementTxn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"increment"</span><span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">reduce</span><span class="op">:</span> callIncrement})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<p>What’s going on? What’s happening? What is this magic?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" data-startfrom="88" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 87;"><span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>incrementTxn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-startfrom="92" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 91;"><span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span><span class="op">*</span> <span class="fu">pollTxn</span>(tx<span class="op">,</span> timeout) {</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span>(<span class="kw">true</span>) {</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> last_response<span class="op">;</span> </span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> receipt <span class="op">=</span> <span class="cf">await</span> wallet<span class="op">.</span><span class="at">provider</span><span class="op">.</span><span class="fu">getTransactionReceipt</span>(tx<span class="op">.</span><span class="at">transaction_hash</span>)</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(receipt)<span class="op">;</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (receipt<span class="op">.</span><span class="at">status</span> <span class="op">==</span> <span class="st">'REJECTED'</span> <span class="op">||</span> receipt<span class="op">.</span><span class="at">status</span> <span class="op">==</span> <span class="st">'ACCEPTED_ON_L2'</span>) {</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> receipt<span class="op">;</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    last_response <span class="op">=</span> receipt<span class="op">;</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> Promises<span class="op">.</span><span class="fu">delay</span>(timeout)<span class="op">;</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (last_response<span class="op">.</span><span class="at">status</span> <span class="op">!=</span> receipt<span class="op">.</span><span class="at">status</span>) {</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> receipt<span class="op">;</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>   <span class="op">;</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" data-startfrom="112" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 111;"><span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>txnTracker <span class="op">=</span> <span class="fu">pollTxn</span>(incrementTxn<span class="op">,</span> <span class="dv">10000</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" data-startfrom="116" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 115;"><span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>txnTracker</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-startfrom="120" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 119;"><span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>contract</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="expression">

</div>
</div>
</div>
</section>
<section id="communication-between-users-applications-blockchains" class="level1">
<h1>communication between users, applications, blockchains</h1>
<p>A wallet gives a user an account on a given blockchain. But implicitly it offers a way for users to communicate with it.</p>
<p>How?</p>
<p>Let’s investigate our <code>wallet</code> object again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-startfrom="132" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 131;"><span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>wallet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="expression">

</div>
</div>
</div>
<p>What are these attributes of <code>account</code> and <code>provider</code>?</p>
<p>A provider lets you interact with the network without signing transactions, which basically means it gives you read access.</p>
<p>When we want write access, we communicate with our account to, in Starknet’s case, the sequencer node.</p>
<p>But how is this communication done?</p>
<p>We can be so bold as to look at <a href="https://github.com/0xs34n/starknet.js/blob/develop/src/provider/rpc.ts">starknetjs source</a> and see that the provider object using an rpc protocol against the provider endpoint.</p>
<p>Same deal with the <a href="https://github.com/0xs34n/starknet.js/blob/develop/src/provider/sequencer.ts">sequencer</a>, but it also seems that some functionality is exposed as http endpoints, i.e.&nbsp;<a href="https://github.com/0xs34n/starknet.js/blob/develop/src/provider/sequencer.ts#L235">callContract</a></p>
<p>So let’s try to follow what is happening when a user interacts with a contract on a web client.</p>
<p>Essentially, starknet-js takes ownership of coordinating users to the right remote calls. In a mature blockchain ecologies, the remote calls are to an open class of processes, where processes can perform certain roles like having access to the full history of blockchain transactions or simply accepting/relaying transactions and participating in consensus.</p>
<p>So when I click the increment button and get back a transaction hash, the user’s action/agency is given an identifiable ticket in a queue of transactions that need to make it to a block for it to be finalized.</p>
<p>A couple things stand out–one, is that ‘reads’ from a contract need to have some awareness of the state of users transactions of the contract at the very least, let alone the possible transactions of other users. This is something I’ll explore in subsequent posts.</p>
<p>I am still unsure how well observablehq’s reactive constructs will play with ‘hooking’ into a blockchain contracts. The allure of starting out with it is offers me more joy than the full gamut react or whatever hell else is popular in js land.</p>
<p>We will see if there’s a hard limit.</p>
<p>Another is, having had a little experience with the early nft wave of Solana, when you are so lucky to have a ‘surge’ of users trying to submit transactions against the same node/rpc, you aren’t going to have a good time. There were a lot of cases of quiet failure.</p>
<p>So the question of the best of all ways to provide your users the smoothest experience with a blockchain might involve a little devops.</p>
<p>Onward.</p>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"starknetjs = import(\"https://jspm.dev/starknet\")\nget_starknet = import(\"https://jspm.dev/get-starknet\")\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"async function connectWallet(e)  {\n   var wallet =  await get_starknet.connect();\n   await wallet.enable();\n   return wallet;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"wallet ? md`${wallet.selectedAddress}, you achieved things. You pushed through. You did it.` : md`Come on. All you need to do is install a browser plugin. You can do it.`\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"viewof wallet = Inputs.button(\"Connect\", {value: null, reduce: connectWallet})\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"wallet\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"contract = {\nvar abi = await FileAttachment(\"../counter_abi.json\").json()\nreturn wallet ? (new starknetjs.Contract(abi, \"0x036486801b8f42e950824cba55b2df8cccb0af2497992f807a7e1d9abd2c6ba1\", wallet.account)) : null\n\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"count = contract.counter()\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"contract ? md`${count} is the count` : null\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"async function callIncrement(e)  {\n   var txn = await contract.incrementCounter(1);\n   return txn;\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"viewof incrementTxn = Inputs.button(\"increment\", {value: null, reduce: callIncrement})\n"},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"incrementTxn\n"},{"methodName":"interpret","cellName":"ojs-cell-12","inline":false,"source":"async function* pollTxn(tx, timeout) {\n while(true) {\n  var last_response; \n  let receipt = await wallet.provider.getTransactionReceipt(tx.transaction_hash)\n  console.log(receipt);\n  if (receipt.status == 'REJECTED' || receipt.status == 'ACCEPTED_ON_L2') {\n    return receipt;\n  } else {\n    last_response = receipt;\n    await Promises.delay(timeout);\n    if (last_response.status != receipt.status) {\n    yield receipt;\n    }\n   ;\n  }\n  }  \n}\n"},{"methodName":"interpret","cellName":"ojs-cell-13","inline":false,"source":"txnTracker = pollTxn(incrementTxn, 10000);\n"},{"methodName":"interpret","cellName":"ojs-cell-14","inline":false,"source":"txnTracker\n"},{"methodName":"interpret","cellName":"ojs-cell-15","inline":false,"source":"contract\n"},{"methodName":"interpret","cellName":"ojs-cell-16","inline":false,"source":"wallet\n"},{"methodName":"interpretQuiet","source":"shinyInput('wallet')"},{"methodName":"interpretQuiet","source":"shinyInput('incrementTxn')"}]}
</script>
<script type="module">
window._ojs.paths.runtimeToDoc = "../../posts/0_hello_wallet";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>